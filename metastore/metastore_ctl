#!/usr/bin/env bash

set -eu

SERVICE="metastore";
BIN_DIR="/opt/${SERVICE}/bin"
RUN_DIR="/var/${SERVICE}/run";
LOG_DIR="/var/${SERVICE}/log";
mkdir -p "${RUN_DIR}" "${LOG_DIR}";

PIDFILE="${RUN_DIR}/${SERVICE}.pid";

source ${BIN_DIR}/utils.sh;
exec 1>> "${LOG_DIR}/${SERVICE}.stdout.log";
exec 2>> "${LOG_DIR}/${SERVICE}.stderr.log";

case "${1}" in
  start)
    pid_guard ${PIDFILE} "${SERVICE}";
    echo $$ > ${PIDFILE};

    exec "start-${SERVICE}" \
      >>  ${LOG_DIR}/${SERVICE}.stdout.log \
      2>> ${LOG_DIR}/${SERVICE}.stderr.log;
    ;;

  stop)
    kill_and_wait ${PIDFILE};
    ;;

  *)
    echo "Usage: $0 {start|stop}";
    exit 1;
    ;;

esac
exit 0;
